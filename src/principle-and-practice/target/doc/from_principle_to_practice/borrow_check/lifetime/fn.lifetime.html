<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="生命周期参数"><title>lifetime in from_principle_to_practice::borrow_check::lifetime - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-0ef3deca4ed45ad8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../../static.files/light-f501212b8b071243.css"><link rel="stylesheet" disabled href="../../../static.files/dark-e92fc12c34ff89d3.css"><link rel="stylesheet" disabled href="../../../static.files/ayu-a0090c8b1ced384f.css"><script id="default-settings" ></script><script src="../../../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-364b95f387bc3166.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../from_principle_to_practice/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../from_principle_to_practice/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><div class="sidebar-elems"><h2><a href="index.html">In from_principle_to_practice::borrow_check::lifetime</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../../index.html">from_principle_to_practice</a>::<wbr><a href="../index.html">borrow_check</a>::<wbr><a href="index.html">lifetime</a>::<wbr><a class="fn" href="#">lifetime</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/from_principle_to_practice/borrow_check/lifetime.rs.html#391">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub fn lifetime()</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h5 id="生命周期参数"><a href="#生命周期参数">生命周期参数</a></h5>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// 示例 1: 声明和使用
   </span><span class="kw">fn </span>return_str&lt;<span class="lifetime">&#39;a</span>&gt;() -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>str {
       <span class="kw">let </span><span class="kw-2">mut </span>s = <span class="string">&quot;Rust&quot;</span>.to_string();

       <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..<span class="number">3 </span>{
           s.push_str(<span class="string">&quot;Good &quot;</span>);
       }

       <span class="comment">//    &amp;s[..] // 不能返回局部变量，会造成悬垂指针
       </span><span class="string">&quot;hello&quot;
   </span>}

   <span class="kw">let </span>x = return_str();</code></pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0A//+%E7%A4%BA%E4%BE%8B+1:+%E5%A3%B0%E6%98%8E%E5%92%8C%E4%BD%BF%E7%94%A8%0Afn+main()+%7B%0Afn+return_str%3C'a%3E()+-%3E+%26'a+str+%7B%0A+++++++let+mut+s+=+%22Rust%22.to_string();%0A%0A+++++++for+i+in+0..3+%7B%0A+++++++++++s.push_str(%22Good+%22);%0A+++++++%7D%0A%0A+++++++//++++%26s%5B..%5D+//+%E4%B8%8D%E8%83%BD%E8%BF%94%E5%9B%9E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%EF%BC%8C%E4%BC%9A%E9%80%A0%E6%88%90%E6%82%AC%E5%9E%82%E6%8C%87%E9%92%88%0A+++++++%22hello%22%0A+++%7D%0A%0A+++let+x+=+return_str();%0A%7D&amp;edition=2021">Run</a></div>
<h5 id="早限定与晚限定"><a href="#早限定与晚限定">早限定与晚限定</a></h5>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code>    <span class="comment">// 示例 2 生命周期参数的之间的关系

    // 当多个参数都是借用类型，需要指定这些参数生命周期参数之间的关系
    // 指定规则:入参声明周期 &gt;= 返回值生命周期
    // &#39;a: &#39;c 代表 &#39;a &gt; &#39;c

    </span><span class="kw">fn </span>the_longest&lt;<span class="lifetime">&#39;c</span>, <span class="lifetime">&#39;a</span>: <span class="lifetime">&#39;c</span>&gt;(s1: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>str, s2: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>str) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;c </span>str {
        <span class="kw">if </span>s1.len() &gt; s2.len() {
            s1
        } <span class="kw">else </span>{
            s2
        }
    }

    <span class="kw">let </span>s1 = String::from(<span class="string">&quot;rust&quot;</span>);
    <span class="kw">let </span>s1_r = <span class="kw-2">&amp;</span>s1;
    {
        <span class="kw">let </span>s2 = String::from(<span class="string">&quot;c&quot;</span>);
        <span class="kw">let </span>res = the_longest(s1_r, <span class="kw-2">&amp;</span>s2);
        <span class="macro">println!</span>(<span class="string">&quot;{:?}&quot;</span>, res);
    }

    <span class="comment">// 示例 3 Rust如何识别并判断生命周期参数的？

    // Rust 实际上使用两套规则：early bound 和 late bound
    // 核心是匹配参数和指定的生命周期参数

    // 示例 4 early bound 和 late bound

    // 先看看泛型案例
    </span><span class="kw">struct </span>A&lt;T&gt;(T);

    <span class="comment">// 定义时不指定类型，实际使用时再指定
    </span><span class="kw">let </span>a = A::&lt;i32&gt;(<span class="number">3</span>);
    <span class="kw">let </span>b = A(<span class="string">&quot;string&quot;</span>);


    <span class="comment">// early bound 和 late bound 区别

    </span><span class="kw">fn </span>f&lt;<span class="lifetime">&#39;a</span>&gt;() {} <span class="comment">// late bound,只声明，不指定。
    </span><span class="kw">fn </span>g&lt;<span class="lifetime">&#39;a</span>: <span class="lifetime">&#39;a</span>&gt;() {} <span class="comment">// early bound，声明且指定
    </span><span class="kw">fn </span>h&lt;T&gt;() {}

    <span class="comment">//let pf = f::&lt;&#39;static&gt; as fn(); // late bound 不能手动指定，编译器会自动生成具体的生命周期参数实例
    </span><span class="kw">let </span>pf = f(); <span class="comment">// late bound 直接使用，不用指定

    // 声明周期参数实际上是泛型的一种
    </span><span class="kw">let </span>ph = h::&lt;i32&gt;(); <span class="comment">// 普通泛型可以指定，会在编译期单态化
    </span><span class="kw">let </span>pg = g::&lt;<span class="lifetime">&#39;static</span>&gt; <span class="kw">as fn</span>(); <span class="comment">// early bound 可以具体再指定

    // 案例 4.1 late bound

    </span><span class="kw">struct </span>Buffer {
        buf: Vec&lt;u8&gt;,
        pos: usize,
    }

    <span class="comment">// 没有在实现方法时指定在impl处
    // 导致的结果时在调用函数时，编译器会检查local 变量
    // 但是使用early bound，编译器只会检查参数类型是否正确以及和生命周期是否匹配

    </span><span class="kw">impl </span>Buffer {
        <span class="kw">fn </span>new() -&gt; Buffer {
            Buffer {
                buf: <span class="macro">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],
                pos: <span class="number">0</span>,
            }
        }

        <span class="comment">// late bound: 声明和使用
        </span><span class="kw">fn </span>read_bytes&lt;<span class="lifetime">&#39;a</span>&gt;(<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span><span class="kw-2">mut </span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8] {
            <span class="self">self</span>.pos += <span class="number">3</span>;
            <span class="kw-2">&amp;</span><span class="self">self</span>.buf[<span class="self">self</span>.pos - <span class="number">3</span>..<span class="self">self</span>.pos]
        }
    }

    <span class="kw">fn </span>print(b1: <span class="kw-2">&amp;</span>[u8], b2: <span class="kw-2">&amp;</span>[u8]) {
        <span class="macro">println!</span>(<span class="string">&quot;{:#?} {:#?}&quot;</span>, b1, b2);
    }


    <span class="kw">let </span><span class="kw-2">mut </span>buf = Buffer::new();
    <span class="kw">let </span>b1 = buf.read_bytes(); <span class="comment">// work

    // late bound 带来的后果
    // 编译器会检查重复可变引用

    //     let b2 = buf.read_bytes(); // 不能同时有两个借用
    //     let b3 = &amp;(buf.read_bytes().to_owned());
    //     print(b1,b2)


    // 案例 4.2 late bound 改写 early bound
    // early bound 提高了生命周期，本质上编译器检查的是两个变量
    // 所以并没有违反借用规则

    </span><span class="kw">struct </span>Buffer1&lt;<span class="lifetime">&#39;a</span>&gt; {
        buf: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8],
        pos: usize,
    }

    <span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; Buffer1&lt;<span class="lifetime">&#39;a</span>&gt; {

        <span class="kw">fn </span>new(b: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8]) -&gt; Buffer1 {
            Buffer1 { buf: b, pos: <span class="number">0 </span>}
        }

        <span class="kw">fn </span>read_bytes(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8] {
            <span class="self">self</span>.pos += <span class="number">3</span>;
            <span class="kw-2">&amp;</span><span class="self">self</span>.buf[<span class="self">self</span>.pos - <span class="number">3</span>..<span class="self">self</span>.pos]
        }
    }

    <span class="kw">let </span>v = <span class="macro">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];

    <span class="kw">let </span><span class="kw-2">mut </span>buf = Buffer1::new(<span class="kw-2">&amp;</span>v);
    <span class="kw">let </span>b1 = buf.read_bytes(); <span class="comment">// work
    </span><span class="kw">let </span>b2 = buf.read_bytes(); <span class="comment">//

    </span>print(b1, b2);

    <span class="comment">// 与如下同理
    </span><span class="kw">let </span><span class="kw-2">mut </span>s = String::from(<span class="string">&quot;hello&quot;</span>);
    <span class="kw">let </span>a = s.push_str(<span class="string">&quot; jian&quot;</span>);
    <span class="kw">let </span>b = s.push_str(<span class="string">&quot; quan&quot;</span>);</code></pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0A++++//+%E7%A4%BA%E4%BE%8B+2+%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%E7%9A%84%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%0A%0A++++//+%E5%BD%93%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E9%83%BD%E6%98%AF%E5%80%9F%E7%94%A8%E7%B1%BB%E5%9E%8B%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E8%BF%99%E4%BA%9B%E5%8F%82%E6%95%B0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%0A++++//+%E6%8C%87%E5%AE%9A%E8%A7%84%E5%88%99:%E5%85%A5%E5%8F%82%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F+%3E=+%E8%BF%94%E5%9B%9E%E5%80%BC%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%0A++++//+'a:+'c+%E4%BB%A3%E8%A1%A8+'a+%3E+'c%0A%0Afn+main()+%7B%0Afn+the_longest%3C'c,+'a:+'c%3E(s1:+%26'a+str,+s2:+%26'a+str)+-%3E+%26'c+str+%7B%0A++++++++if+s1.len()+%3E+s2.len()+%7B%0A++++++++++++s1%0A++++++++%7D+else+%7B%0A++++++++++++s2%0A++++++++%7D%0A++++%7D%0A%0A++++let+s1+=+String::from(%22rust%22);%0A++++let+s1_r+=+%26s1;%0A++++%7B%0A++++++++let+s2+=+String::from(%22c%22);%0A++++++++let+res+=+the_longest(s1_r,+%26s2);%0A++++++++println!(%22%7B:?%7D%22,+res);%0A++++%7D%0A%0A++++//+%E7%A4%BA%E4%BE%8B+3+Rust%E5%A6%82%E4%BD%95%E8%AF%86%E5%88%AB%E5%B9%B6%E5%88%A4%E6%96%AD%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%E7%9A%84%EF%BC%9F%0A%0A++++//+Rust+%E5%AE%9E%E9%99%85%E4%B8%8A%E4%BD%BF%E7%94%A8%E4%B8%A4%E5%A5%97%E8%A7%84%E5%88%99%EF%BC%9Aearly+bound+%E5%92%8C+late+bound%0A++++//+%E6%A0%B8%E5%BF%83%E6%98%AF%E5%8C%B9%E9%85%8D%E5%8F%82%E6%95%B0%E5%92%8C%E6%8C%87%E5%AE%9A%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%0A%0A++++//+%E7%A4%BA%E4%BE%8B+4+early+bound+%E5%92%8C+late+bound%0A%0A++++//+%E5%85%88%E7%9C%8B%E7%9C%8B%E6%B3%9B%E5%9E%8B%E6%A1%88%E4%BE%8B%0A++++struct+A%3CT%3E(T);%0A%0A++++//+%E5%AE%9A%E4%B9%89%E6%97%B6%E4%B8%8D%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8%E6%97%B6%E5%86%8D%E6%8C%87%E5%AE%9A%0A++++let+a+=+A::%3Ci32%3E(3);%0A++++let+b+=+A(%22string%22);%0A%0A%0A++++//+early+bound+%E5%92%8C+late+bound+%E5%8C%BA%E5%88%AB%0A%0A++++fn+f%3C'a%3E()+%7B%7D+//+late+bound,%E5%8F%AA%E5%A3%B0%E6%98%8E%EF%BC%8C%E4%B8%8D%E6%8C%87%E5%AE%9A%E3%80%82%0A++++fn+g%3C'a:+'a%3E()+%7B%7D+//+early+bound%EF%BC%8C%E5%A3%B0%E6%98%8E%E4%B8%94%E6%8C%87%E5%AE%9A%0A++++fn+h%3CT%3E()+%7B%7D%0A%0A++++//let+pf+=+f::%3C'static%3E+as+fn();+//+late+bound+%E4%B8%8D%E8%83%BD%E6%89%8B%E5%8A%A8%E6%8C%87%E5%AE%9A%EF%BC%8C%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%9A%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%85%B7%E4%BD%93%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%E5%AE%9E%E4%BE%8B%0A++++let+pf+=+f();+//+late+bound+%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%EF%BC%8C%E4%B8%8D%E7%94%A8%E6%8C%87%E5%AE%9A%0A%0A++++//+%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%E5%AE%9E%E9%99%85%E4%B8%8A%E6%98%AF%E6%B3%9B%E5%9E%8B%E7%9A%84%E4%B8%80%E7%A7%8D%0A++++let+ph+=+h::%3Ci32%3E();+//+%E6%99%AE%E9%80%9A%E6%B3%9B%E5%9E%8B%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%EF%BC%8C%E4%BC%9A%E5%9C%A8%E7%BC%96%E8%AF%91%E6%9C%9F%E5%8D%95%E6%80%81%E5%8C%96%0A++++let+pg+=+g::%3C'static%3E+as+fn();+//+early+bound+%E5%8F%AF%E4%BB%A5%E5%85%B7%E4%BD%93%E5%86%8D%E6%8C%87%E5%AE%9A%0A%0A++++//+%E6%A1%88%E4%BE%8B+4.1+late+bound%0A%0A++++struct+Buffer+%7B%0A++++++++buf:+Vec%3Cu8%3E,%0A++++++++pos:+usize,%0A++++%7D%0A%0A++++//+%E6%B2%A1%E6%9C%89%E5%9C%A8%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95%E6%97%B6%E6%8C%87%E5%AE%9A%E5%9C%A8impl%E5%A4%84%0A++++//+%E5%AF%BC%E8%87%B4%E7%9A%84%E7%BB%93%E6%9E%9C%E6%97%B6%E5%9C%A8%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E6%97%B6%EF%BC%8C%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%9A%E6%A3%80%E6%9F%A5local+%E5%8F%98%E9%87%8F%0A++++//+%E4%BD%86%E6%98%AF%E4%BD%BF%E7%94%A8early+bound%EF%BC%8C%E7%BC%96%E8%AF%91%E5%99%A8%E5%8F%AA%E4%BC%9A%E6%A3%80%E6%9F%A5%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE%E4%BB%A5%E5%8F%8A%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D%0A%0A++++impl+Buffer+%7B%0A++++++++fn+new()+-%3E+Buffer+%7B%0A++++++++++++Buffer+%7B%0A++++++++++++++++buf:+vec!%5B1,+2,+3,+4,+5,+6%5D,%0A++++++++++++++++pos:+0,%0A++++++++++++%7D%0A++++++++%7D%0A%0A++++++++//+late+bound:+%E5%A3%B0%E6%98%8E%E5%92%8C%E4%BD%BF%E7%94%A8%0A++++++++fn+read_bytes%3C'a%3E(%26'a+mut+self)+-%3E+%26'a+%5Bu8%5D+%7B%0A++++++++++++self.pos+%2B=+3;%0A++++++++++++%26self.buf%5Bself.pos+-+3..self.pos%5D%0A++++++++%7D%0A++++%7D%0A%0A++++fn+print(b1:+%26%5Bu8%5D,+b2:+%26%5Bu8%5D)+%7B%0A++++++++println!(%22%7B:%23?%7D+%7B:%23?%7D%22,+b1,+b2);%0A++++%7D%0A%0A%0A++++let+mut+buf+=+Buffer::new();%0A++++let+b1+=+buf.read_bytes();+//+work%0A%0A++++//+late+bound+%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%90%8E%E6%9E%9C%0A++++//+%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%9A%E6%A3%80%E6%9F%A5%E9%87%8D%E5%A4%8D%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8%0A%0A++++//+++++let+b2+=+buf.read_bytes();+//+%E4%B8%8D%E8%83%BD%E5%90%8C%E6%97%B6%E6%9C%89%E4%B8%A4%E4%B8%AA%E5%80%9F%E7%94%A8%0A++++//+++++let+b3+=+%26(buf.read_bytes().to_owned());%0A++++//+++++print(b1,b2)%0A%0A%0A++++//+%E6%A1%88%E4%BE%8B+4.2+late+bound+%E6%94%B9%E5%86%99+early+bound%0A++++//+early+bound+%E6%8F%90%E9%AB%98%E4%BA%86%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%8C%E6%9C%AC%E8%B4%A8%E4%B8%8A%E7%BC%96%E8%AF%91%E5%99%A8%E6%A3%80%E6%9F%A5%E7%9A%84%E6%98%AF%E4%B8%A4%E4%B8%AA%E5%8F%98%E9%87%8F%0A++++//+%E6%89%80%E4%BB%A5%E5%B9%B6%E6%B2%A1%E6%9C%89%E8%BF%9D%E5%8F%8D%E5%80%9F%E7%94%A8%E8%A7%84%E5%88%99%0A%0A++++struct+Buffer1%3C'a%3E+%7B%0A++++++++buf:+%26'a+%5Bu8%5D,%0A++++++++pos:+usize,%0A++++%7D%0A%0A++++impl%3C'a%3E+Buffer1%3C'a%3E+%7B%0A%0A++++++++fn+new(b:+%26'a+%5Bu8%5D)+-%3E+Buffer1+%7B%0A++++++++++++Buffer1+%7B+buf:+b,+pos:+0+%7D%0A++++++++%7D%0A%0A++++++++fn+read_bytes(%26mut+self)+-%3E+%26'a+%5Bu8%5D+%7B%0A++++++++++++self.pos+%2B=+3;%0A++++++++++++%26self.buf%5Bself.pos+-+3..self.pos%5D%0A++++++++%7D%0A++++%7D%0A%0A++++let+v+=+vec!%5B1,+2,+3,+4,+5,+6%5D;%0A%0A++++let+mut+buf+=+Buffer1::new(%26v);%0A++++let+b1+=+buf.read_bytes();+//+work%0A++++let+b2+=+buf.read_bytes();+//%0A%0A++++print(b1,+b2);%0A%0A++++//+%E4%B8%8E%E5%A6%82%E4%B8%8B%E5%90%8C%E7%90%86%0A++++let+mut+s+=+String::from(%22hello%22);%0A++++let+a+=+s.push_str(%22+jian%22);%0A++++let+b+=+s.push_str(%22+quan%22);%0A%7D&amp;edition=2021">Run</a></div>
<h4 id="t和t"><a href="#t和t">&amp;T和T</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code> <span class="kw">trait </span>Trait {
       <span class="kw">fn </span>f(<span class="self">self</span>);
   }
   <span class="kw">impl</span>&lt;T&gt; Trait <span class="kw">for fn</span>(T) { <span class="comment">// 此处的T指值或者引用
       </span><span class="kw">fn </span>f(<span class="self">self</span>) {
           <span class="macro">print!</span>(<span class="string">&quot;1&quot;</span>)
       }
   }
   <span class="kw">impl</span>&lt;T&gt; Trait <span class="kw">for fn</span>(<span class="kw-2">&amp;</span>T) { <span class="comment">// &amp;T 指引用
       </span><span class="kw">fn </span>f(<span class="self">self</span>) {
           <span class="macro">print!</span>(<span class="string">&quot;2&quot;</span>)
       }
   }

   <span class="kw">let </span>a: <span class="kw">fn</span>(<span class="kw">_</span>) = |<span class="kw">_</span>: u8| {};
   <span class="kw">let </span>b: <span class="kw">fn</span>(<span class="kw">_</span>) = |<span class="kw">_</span>: <span class="kw-2">&amp;</span>u8| {};
   <span class="kw">let </span>c: <span class="kw">fn</span>(<span class="kw-2">&amp;</span><span class="kw">_</span>) = |<span class="kw">_</span>: <span class="kw-2">&amp;</span>u8| {}; <span class="comment">//实例化

   // 编译器会根据地函数参数以及制定的类型来调用
   </span>a.f(); <span class="comment">// 1
   </span>b.f(); <span class="comment">// 1
   </span>c.f(); <span class="comment">// 2

   // T 与 &amp;T，后者是前者的子集
   // 但是可以为后者实现特殊的方法重载
   </span><span class="kw">trait </span>Trait {
       <span class="kw">fn </span>f(<span class="self">self</span>);
   }
   <span class="kw">impl</span>&lt;T&gt; Trait <span class="kw">for fn</span>(T) {
       <span class="kw">fn </span>f(<span class="self">self</span>) {
           <span class="macro">print!</span>(<span class="string">&quot;1&quot;</span>)
       }
   }

   <span class="comment">//     impl&lt;&#39;a,T&gt; Trait for fn(&amp;&#39;a T) {
   </span><span class="kw">impl</span>&lt;T&gt; Trait <span class="kw">for fn</span>(<span class="kw-2">&amp;</span>T) {
       <span class="comment">// 此处会生命和使用默认的生命周期参数，不可以手动显式声明
       // 因为参数是引用类型
       </span><span class="kw">fn </span>f(<span class="self">self</span>) {
           <span class="macro">print!</span>(<span class="string">&quot;2&quot;</span>)
       }
   }

   <span class="kw">let </span>a: <span class="kw">fn</span>(<span class="kw">_</span>) = |<span class="kw">_</span>: u8| {};
   <span class="kw">let </span>b: <span class="kw">fn</span>(<span class="kw">_</span>) = |<span class="kw">_</span>: <span class="kw-2">&amp;</span>u8| {}; <span class="comment">// 编译器会为参数默认加上生命周期参数x，同 &amp;&#39;x u8
   </span><span class="kw">let </span>c: <span class="kw">fn</span>(<span class="kw-2">&amp;</span><span class="kw">_</span>) = |<span class="kw">_</span>: <span class="kw-2">&amp;</span>u8| {}; <span class="comment">//在此处会实例化，也是一个late bound的case

   </span>a.f(); <span class="comment">// 1
   </span>b.f(); <span class="comment">// 1
   </span>c.f(); <span class="comment">// 2

   // early bound 还体现在函数第二个（第n个）参数的调用上
   //case 2

   </span><span class="kw">use </span>std::collections::HashSet;
   <span class="kw">let </span>hello = <span class="string">&quot;hello&quot;</span>.to_owned();
   <span class="kw">let </span><span class="kw-2">mut </span>items: HashSet&lt;<span class="kw-2">&amp;</span>str&gt; = HashSet::new();

   items.insert(hello.as_str());

   <span class="kw">let </span><span class="kw-2">mut </span>global_set: HashSet&lt;<span class="kw-2">&amp;</span>str&gt; = HashSet::new();
   global_set.insert(hello.as_str());

   <span class="kw">while </span>!global_set.is_empty() {
       <span class="kw">let </span><span class="kw-2">mut </span>temp_set: HashSet&lt;<span class="kw-2">&amp;</span>str&gt; = HashSet::new();

       <span class="kw">for </span><span class="kw-2">&amp;</span>item <span class="kw">in </span>global_set.iter() {
           <span class="kw">let </span>copy = item.to_owned();
           <span class="kw">let </span>copy_str = copy.as_str(); <span class="comment">// &amp;self

           // 此处不能使用get(&amp;copy_str),如果再借用一次，当离开copy的作用域时，仍然使用
           // 再借用就判断符合上下文
           // 不加编译器只会判断get函数
           </span><span class="kw">if let </span><span class="prelude-val">Some</span>(inner) = items.get(copy_str).cloned() {
               temp_set.insert(inner);
           }
       }

       std::mem::swap(<span class="kw-2">&amp;mut </span>global_set, <span class="kw-2">&amp;mut </span>temp_set);
       <span class="kw">break</span>;
   }</code></pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn+main()+%7B%0Atrait+Trait+%7B%0A+++++++fn+f(self);%0A+++%7D%0A+++impl%3CT%3E+Trait+for+fn(T)+%7B+//+%E6%AD%A4%E5%A4%84%E7%9A%84T%E6%8C%87%E5%80%BC%E6%88%96%E8%80%85%E5%BC%95%E7%94%A8%0A+++++++fn+f(self)+%7B%0A+++++++++++print!(%221%22)%0A+++++++%7D%0A+++%7D%0A+++impl%3CT%3E+Trait+for+fn(%26T)+%7B+//+%26T+%E6%8C%87%E5%BC%95%E7%94%A8%0A+++++++fn+f(self)+%7B%0A+++++++++++print!(%222%22)%0A+++++++%7D%0A+++%7D%0A%0A+++let+a:+fn(_)+=+%7C_:+u8%7C+%7B%7D;%0A+++let+b:+fn(_)+=+%7C_:+%26u8%7C+%7B%7D;%0A+++let+c:+fn(%26_)+=+%7C_:+%26u8%7C+%7B%7D;+//%E5%AE%9E%E4%BE%8B%E5%8C%96%0A%0A+++//+%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%9A%E6%A0%B9%E6%8D%AE%E5%9C%B0%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E4%BB%A5%E5%8F%8A%E5%88%B6%E5%AE%9A%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%9D%A5%E8%B0%83%E7%94%A8%0A+++a.f();+//+1%0A+++b.f();+//+1%0A+++c.f();+//+2%0A%0A+++//+T+%E4%B8%8E+%26T%EF%BC%8C%E5%90%8E%E8%80%85%E6%98%AF%E5%89%8D%E8%80%85%E7%9A%84%E5%AD%90%E9%9B%86%0A+++//+%E4%BD%86%E6%98%AF%E5%8F%AF%E4%BB%A5%E4%B8%BA%E5%90%8E%E8%80%85%E5%AE%9E%E7%8E%B0%E7%89%B9%E6%AE%8A%E7%9A%84%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD%0A+++trait+Trait+%7B%0A+++++++fn+f(self);%0A+++%7D%0A+++impl%3CT%3E+Trait+for+fn(T)+%7B%0A+++++++fn+f(self)+%7B%0A+++++++++++print!(%221%22)%0A+++++++%7D%0A+++%7D%0A%0A+++//+++++impl%3C'a,T%3E+Trait+for+fn(%26'a+T)+%7B%0A+++impl%3CT%3E+Trait+for+fn(%26T)+%7B%0A+++++++//+%E6%AD%A4%E5%A4%84%E4%BC%9A%E7%94%9F%E5%91%BD%E5%92%8C%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%EF%BC%8C%E4%B8%8D%E5%8F%AF%E4%BB%A5%E6%89%8B%E5%8A%A8%E6%98%BE%E5%BC%8F%E5%A3%B0%E6%98%8E%0A+++++++//+%E5%9B%A0%E4%B8%BA%E5%8F%82%E6%95%B0%E6%98%AF%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%0A+++++++fn+f(self)+%7B%0A+++++++++++print!(%222%22)%0A+++++++%7D%0A+++%7D%0A%0A+++let+a:+fn(_)+=+%7C_:+u8%7C+%7B%7D;%0A+++let+b:+fn(_)+=+%7C_:+%26u8%7C+%7B%7D;+//+%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%9A%E4%B8%BA%E5%8F%82%E6%95%B0%E9%BB%98%E8%AE%A4%E5%8A%A0%E4%B8%8A%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0x%EF%BC%8C%E5%90%8C+%26'x+u8%0A+++let+c:+fn(%26_)+=+%7C_:+%26u8%7C+%7B%7D;+//%E5%9C%A8%E6%AD%A4%E5%A4%84%E4%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%B8%80%E4%B8%AAlate+bound%E7%9A%84case%0A%0A+++a.f();+//+1%0A+++b.f();+//+1%0A+++c.f();+//+2%0A%0A+++//+early+bound+%E8%BF%98%E4%BD%93%E7%8E%B0%E5%9C%A8%E5%87%BD%E6%95%B0%E7%AC%AC%E4%BA%8C%E4%B8%AA%EF%BC%88%E7%AC%ACn%E4%B8%AA%EF%BC%89%E5%8F%82%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8%E4%B8%8A%0A+++//case+2%0A%0A+++use+std::collections::HashSet;%0A+++let+hello+=+%22hello%22.to_owned();%0A+++let+mut+items:+HashSet%3C%26str%3E+=+HashSet::new();%0A%0A+++items.insert(hello.as_str());%0A%0A+++let+mut+global_set:+HashSet%3C%26str%3E+=+HashSet::new();%0A+++global_set.insert(hello.as_str());%0A%0A+++while+!global_set.is_empty()+%7B%0A+++++++let+mut+temp_set:+HashSet%3C%26str%3E+=+HashSet::new();%0A%0A+++++++for+%26item+in+global_set.iter()+%7B%0A+++++++++++let+copy+=+item.to_owned();%0A+++++++++++let+copy_str+=+copy.as_str();+//+%26self%0A%0A+++++++++++//+%E6%AD%A4%E5%A4%84%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8get(%26copy_str),%E5%A6%82%E6%9E%9C%E5%86%8D%E5%80%9F%E7%94%A8%E4%B8%80%E6%AC%A1%EF%BC%8C%E5%BD%93%E7%A6%BB%E5%BC%80copy%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%97%B6%EF%BC%8C%E4%BB%8D%E7%84%B6%E4%BD%BF%E7%94%A8%0A+++++++++++//+%E5%86%8D%E5%80%9F%E7%94%A8%E5%B0%B1%E5%88%A4%E6%96%AD%E7%AC%A6%E5%90%88%E4%B8%8A%E4%B8%8B%E6%96%87%0A+++++++++++//+%E4%B8%8D%E5%8A%A0%E7%BC%96%E8%AF%91%E5%99%A8%E5%8F%AA%E4%BC%9A%E5%88%A4%E6%96%ADget%E5%87%BD%E6%95%B0%0A+++++++++++if+let+Some(inner)+=+items.get(copy_str).cloned()+%7B%0A+++++++++++++++temp_set.insert(inner);%0A+++++++++++%7D%0A+++++++%7D%0A%0A+++++++std::mem::swap(%26mut+global_set,+%26mut+temp_set);%0A+++++++break;%0A+++%7D%0A%7D&amp;edition=2021">Run</a></div>
<h4 id="trait-对象的生命周期参数"><a href="#trait-对象的生命周期参数">trait 对象的生命周期参数</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">struct </span>FooImpl&lt;<span class="lifetime">&#39;a</span>&gt; {
       s: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u32],
   }
   <span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; Foo&lt;<span class="lifetime">&#39;a</span>&gt; <span class="kw">for </span>FooImpl&lt;<span class="lifetime">&#39;a</span>&gt; {}

   <span class="comment">// trait 对象必须使用 Box包裹
   // 任何实现了 某个trait的类型，它的实例都是 trait对象
   // trait 对象默认为静态生命周期，当作为返回值时，需要手动“缩短”（指定生命周期参数，如‘a）

   // fn foo&lt;&#39;a, &#39;b: &#39;a&gt;(s: &amp;&#39;a [u32]) -&gt; Box&lt;dyn Foo&lt;&#39;a&gt; + &#39;a&gt; { //第一种写法
   </span><span class="kw">fn </span>foo&lt;<span class="lifetime">&#39;a</span>&gt;(s: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u32]) -&gt; Box&lt;<span class="kw">dyn </span>Foo&lt;<span class="lifetime">&#39;a</span>&gt; + <span class="lifetime">&#39;a</span>&gt; {
       <span class="comment">// 第二种写法
       </span>Box::new(FooImpl { s: s })
   }
</code></pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn+main()+%7B%0Astruct+FooImpl%3C'a%3E+%7B%0A+++++++s:+%26'a+%5Bu32%5D,%0A+++%7D%0A+++impl%3C'a%3E+Foo%3C'a%3E+for+FooImpl%3C'a%3E+%7B%7D%0A%0A+++//+trait+%E5%AF%B9%E8%B1%A1%E5%BF%85%E9%A1%BB%E4%BD%BF%E7%94%A8+Box%E5%8C%85%E8%A3%B9%0A+++//+%E4%BB%BB%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%BA%86+%E6%9F%90%E4%B8%AAtrait%E7%9A%84%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%AE%83%E7%9A%84%E5%AE%9E%E4%BE%8B%E9%83%BD%E6%98%AF+trait%E5%AF%B9%E8%B1%A1%0A+++//+trait+%E5%AF%B9%E8%B1%A1%E9%BB%98%E8%AE%A4%E4%B8%BA%E9%9D%99%E6%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%8C%E5%BD%93%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC%E6%97%B6%EF%BC%8C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E2%80%9C%E7%BC%A9%E7%9F%AD%E2%80%9D%EF%BC%88%E6%8C%87%E5%AE%9A%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0%EF%BC%8C%E5%A6%82%E2%80%98a%EF%BC%89%0A%0A+++//+fn+foo%3C'a,+'b:+'a%3E(s:+%26'a+%5Bu32%5D)+-%3E+Box%3Cdyn+Foo%3C'a%3E+%2B+'a%3E+%7B+//%E7%AC%AC%E4%B8%80%E7%A7%8D%E5%86%99%E6%B3%95%0A+++fn+foo%3C'a%3E(s:+%26'a+%5Bu32%5D)+-%3E+Box%3Cdyn+Foo%3C'a%3E+%2B+'a%3E+%7B%0A+++++++//+%E7%AC%AC%E4%BA%8C%E7%A7%8D%E5%86%99%E6%B3%95%0A+++++++Box::new(FooImpl+%7B+s:+s+%7D)%0A+++%7D%0A%7D&amp;edition=2021">Run</a></div>
<h4 id="高阶生命周期参数"><a href="#高阶生命周期参数">高阶生命周期参数</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code>   <span class="comment">// 1.使用高阶生命参数 for语法
   </span><span class="kw">use </span>std::fmt::Debug;
   <span class="kw">trait </span>DosSomething&lt;T&gt; {
       <span class="kw">fn </span>do_something(<span class="kw-2">&amp;</span><span class="self">self</span>, value: T);
   }

   <span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>, T: Debug&gt; DosSomething&lt;T&gt; <span class="kw">for </span><span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>usize {
       <span class="kw">fn </span>do_something(<span class="kw-2">&amp;</span><span class="self">self</span>, value: T) {
           <span class="macro">println!</span>(<span class="string">&quot;{:?}&quot;</span>, value);
       }
   }

   <span class="comment">// 高阶生命周期，高阶限定，for语法，是一种late bound
   //     fn foo&lt;&#39;a&gt;(b: Box&lt;dyn DosSomething&lt;&amp;&#39;a usize&gt;&gt;) { 改动前
   </span><span class="kw">fn </span>foo&lt;<span class="lifetime">&#39;a</span>&gt;(b: Box&lt;<span class="kw">dyn for</span>&lt;<span class="lifetime">&#39;f</span>&gt; DosSomething&lt;<span class="kw-2">&amp;</span><span class="lifetime">&#39;f </span>usize&gt;&gt;) {
       <span class="comment">// 不在当前作用域判断
       </span><span class="kw">let </span>s: usize = <span class="number">10</span>;
       b.do_something(<span class="kw-2">&amp;</span>s) <span class="comment">// 在do something 函数作用域判断
   </span>}

   <span class="kw">let </span>x = Box::new(<span class="kw-2">&amp;</span><span class="number">2usize</span>);
   foo(x)

   <span class="comment">// 2.高阶生命参数在闭包中的用法

   // 不能通过高阶语法来修复
   // let f = |x: &amp;i32| x;
   // 如：
   // let f: for&lt;&#39;a&gt; Fn(&amp;&#39;a i32) -&gt; &amp;&#39;a i32 = |x| x;
   // fn foo&lt;&#39;a&gt;(b: Box&lt;dyn for&lt;&#39;f&gt; DosSomething&lt;&amp;&#39;f usize&gt;&gt;) {

   // 修复方法 1：通过外部函数 late bound
   // 函数返回F,F为实现了 Fn trait的闭包，并且是late bound
   </span><span class="kw">fn </span>annotate1&lt;T, F&gt;(f: F) -&gt; F
   <span class="kw">where
       for</span>&lt;<span class="lifetime">&#39;a</span>&gt; F: Fn(<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>T,
   {
       f
   }

   <span class="comment">// 修复方法2：通过外部函数 early bound
   </span><span class="kw">fn </span>annotate2&lt;<span class="lifetime">&#39;a</span>, T: <span class="lifetime">&#39;a</span>, F&gt;(f: F) -&gt; F
   <span class="kw">where
       </span>F: Fn(<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>T) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>T,
   {
       f
   }

   <span class="comment">// 不管怎么样，都是告诉编译器该怎么判断

   </span><span class="kw">let </span>f = annotate1(|x: <span class="kw-2">&amp;</span>i32| x);
   <span class="kw">let </span>f = annotate2(|x: <span class="kw-2">&amp;</span>i32| x);
   <span class="kw">let </span>i = <span class="kw-2">&amp;</span><span class="number">3</span>;
   <span class="kw">let </span>j = f(i); <span class="comment">// 本身是为了使用这个闭包，在这里才会检查x

   // 3.高阶生命周期参数 trait应用

   // trait 对象高阶生命参数 for 在多态调用中的应用
   </span><span class="kw">use </span>rand;
   <span class="kw">use </span>std::io::Read;

   <span class="kw">trait </span>CheckSum&lt;R: Read&gt; {
       <span class="kw">fn </span>calc(<span class="kw-2">&amp;mut </span><span class="self">self</span>, r: R) -&gt; Vec&lt;u8&gt;;
   }

   <span class="kw">struct </span>Xor;

   <span class="kw">impl</span>&lt;R: Read&gt; CheckSum&lt;R&gt; <span class="kw">for </span>Xor {
       <span class="kw">fn </span>calc(<span class="kw-2">&amp;mut </span><span class="self">self</span>, <span class="kw-2">mut </span>r: R) -&gt; Vec&lt;u8&gt; {
           <span class="kw">let </span><span class="kw-2">mut </span>res: u8 = <span class="number">0</span>;
           <span class="kw">let </span><span class="kw-2">mut </span>buf = [<span class="number">0u8</span>; <span class="number">8</span>];

           <span class="kw">loop </span>{
               <span class="kw">let </span>read = r.read(<span class="kw-2">&amp;mut </span>buf).unwrap();
               <span class="kw">if </span>read == <span class="number">0 </span>{
                   <span class="kw">break</span>;
               }

               <span class="kw">for </span>b <span class="kw">in </span><span class="kw-2">&amp;</span>buf[..read] {
                   res ^= b;
               }
           }
           <span class="macro">vec!</span>[res]
       }
   }

   <span class="kw">struct </span>Add;

   <span class="kw">impl</span>&lt;R: Read&gt; CheckSum&lt;R&gt; <span class="kw">for </span>Add {
       <span class="kw">fn </span>calc(<span class="kw-2">&amp;mut </span><span class="self">self</span>, <span class="kw-2">mut </span>r: R) -&gt; Vec&lt;u8&gt; {
           <span class="kw">let </span><span class="kw-2">mut </span>res: u8 = <span class="number">0</span>;
           <span class="kw">let </span><span class="kw-2">mut </span>buf = [<span class="number">0u8</span>; <span class="number">8</span>];

           <span class="kw">loop </span>{
               <span class="kw">let </span>read = r.read(<span class="kw-2">&amp;mut </span>buf).unwrap();
               <span class="kw">if </span>read == <span class="number">0 </span>{
                   <span class="kw">break</span>;
               }
               <span class="comment">// late bound
               </span><span class="kw">for </span>b <span class="kw">in </span><span class="kw-2">&amp;</span>buf[..read] {
                   <span class="kw">let </span>tmp = res <span class="kw">as </span>u16 + <span class="kw-2">*</span>b <span class="kw">as </span>u16;
                   res = tmp <span class="kw">as </span>u8;
               }
           }
           <span class="macro">vec!</span>[res]
       }
   }

   <span class="kw">let </span><span class="kw-2">mut </span>buf = [<span class="number">0u8</span>; <span class="number">128</span>];

   <span class="comment">// late bound
   </span><span class="kw">let </span><span class="kw-2">mut </span>checker: Box&lt;<span class="kw">dyn for</span>&lt;<span class="lifetime">&#39;f</span>&gt; CheckSum&lt;<span class="kw-2">&amp;</span><span class="lifetime">&#39;f </span>[u8]&gt;&gt; = <span class="kw">if </span>rand::random() {
       <span class="macro">println!</span>(<span class="string">&quot;Initializing Xor Checksum&quot;</span>);
       Box::new(Xor)
   } <span class="kw">else </span>{
       <span class="macro">println!</span>(<span class="string">&quot;Initializing Add Checksum&quot;</span>);
       Box::new(Add)
   };

   <span class="kw">let </span><span class="kw-2">mut </span>data = <span class="string">&quot;data.read(&amp;mut buf).unwrap()&quot;</span>.as_bytes();
   <span class="kw">let </span><span class="kw-2">mut </span>i = <span class="number">0</span>;

   <span class="kw">loop </span>{
       <span class="kw">let </span>chunk_size = data.read(<span class="kw-2">&amp;mut </span>buf).unwrap();
       <span class="kw">if </span>chunk_size == <span class="number">0 </span>{
           <span class="kw">break</span>;
       }
       <span class="kw">let </span>cs = checker.calc(<span class="kw-2">&amp;</span>buf[..chunk_size]);
       <span class="macro">println!</span>(<span class="string">&quot;CheckSum {} is {:?}&quot;</span>, i, cs);
       i += <span class="number">1</span>;
   }
</code></pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0A+++//+1.%E4%BD%BF%E7%94%A8%E9%AB%98%E9%98%B6%E7%94%9F%E5%91%BD%E5%8F%82%E6%95%B0+for%E8%AF%AD%E6%B3%95%0Afn+main()+%7B%0Ause+std::fmt::Debug;%0A+++trait+DosSomething%3CT%3E+%7B%0A+++++++fn+do_something(%26self,+value:+T);%0A+++%7D%0A%0A+++impl%3C'a,+T:+Debug%3E+DosSomething%3CT%3E+for+%26'a+usize+%7B%0A+++++++fn+do_something(%26self,+value:+T)+%7B%0A+++++++++++println!(%22%7B:?%7D%22,+value);%0A+++++++%7D%0A+++%7D%0A%0A+++//+%E9%AB%98%E9%98%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%8C%E9%AB%98%E9%98%B6%E9%99%90%E5%AE%9A%EF%BC%8Cfor%E8%AF%AD%E6%B3%95%EF%BC%8C%E6%98%AF%E4%B8%80%E7%A7%8Dlate+bound%0A+++//+++++fn+foo%3C'a%3E(b:+Box%3Cdyn+DosSomething%3C%26'a+usize%3E%3E)+%7B+%E6%94%B9%E5%8A%A8%E5%89%8D%0A+++fn+foo%3C'a%3E(b:+Box%3Cdyn+for%3C'f%3E+DosSomething%3C%26'f+usize%3E%3E)+%7B%0A+++++++//+%E4%B8%8D%E5%9C%A8%E5%BD%93%E5%89%8D%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%88%A4%E6%96%AD%0A+++++++let+s:+usize+=+10;%0A+++++++b.do_something(%26s)+//+%E5%9C%A8do+something+%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%88%A4%E6%96%AD%0A+++%7D%0A%0A+++let+x+=+Box::new(%262usize);%0A+++foo(x)%0A%0A+++//+2.%E9%AB%98%E9%98%B6%E7%94%9F%E5%91%BD%E5%8F%82%E6%95%B0%E5%9C%A8%E9%97%AD%E5%8C%85%E4%B8%AD%E7%9A%84%E7%94%A8%E6%B3%95%0A%0A+++//+%E4%B8%8D%E8%83%BD%E9%80%9A%E8%BF%87%E9%AB%98%E9%98%B6%E8%AF%AD%E6%B3%95%E6%9D%A5%E4%BF%AE%E5%A4%8D%0A+++//+let+f+=+%7Cx:+%26i32%7C+x;%0A+++//+%E5%A6%82%EF%BC%9A%0A+++//+let+f:+for%3C'a%3E+Fn(%26'a+i32)+-%3E+%26'a+i32+=+%7Cx%7C+x;%0A+++//+fn+foo%3C'a%3E(b:+Box%3Cdyn+for%3C'f%3E+DosSomething%3C%26'f+usize%3E%3E)+%7B%0A%0A+++//+%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%B3%95+1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0+late+bound%0A+++//+%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9EF,F%E4%B8%BA%E5%AE%9E%E7%8E%B0%E4%BA%86+Fn+trait%E7%9A%84%E9%97%AD%E5%8C%85%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%98%AFlate+bound%0A+++fn+annotate1%3CT,+F%3E(f:+F)+-%3E+F%0A+++where%0A+++++++for%3C'a%3E+F:+Fn(%26'a+T)+-%3E+%26'a+T,%0A+++%7B%0A+++++++f%0A+++%7D%0A%0A+++//+%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%B3%952%EF%BC%9A%E9%80%9A%E8%BF%87%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0+early+bound%0A+++fn+annotate2%3C'a,+T:+'a,+F%3E(f:+F)+-%3E+F%0A+++where%0A+++++++F:+Fn(%26'a+T)+-%3E+%26'a+T,%0A+++%7B%0A+++++++f%0A+++%7D%0A%0A+++//+%E4%B8%8D%E7%AE%A1%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%8C%E9%83%BD%E6%98%AF%E5%91%8A%E8%AF%89%E7%BC%96%E8%AF%91%E5%99%A8%E8%AF%A5%E6%80%8E%E4%B9%88%E5%88%A4%E6%96%AD%0A%0A+++let+f+=+annotate1(%7Cx:+%26i32%7C+x);%0A+++let+f+=+annotate2(%7Cx:+%26i32%7C+x);%0A+++let+i+=+%263;%0A+++let+j+=+f(i);+//+%E6%9C%AC%E8%BA%AB%E6%98%AF%E4%B8%BA%E4%BA%86%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E9%97%AD%E5%8C%85%EF%BC%8C%E5%9C%A8%E8%BF%99%E9%87%8C%E6%89%8D%E4%BC%9A%E6%A3%80%E6%9F%A5x%0A%0A+++//+3.%E9%AB%98%E9%98%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E6%95%B0+trait%E5%BA%94%E7%94%A8%0A%0A+++//+trait+%E5%AF%B9%E8%B1%A1%E9%AB%98%E9%98%B6%E7%94%9F%E5%91%BD%E5%8F%82%E6%95%B0+for+%E5%9C%A8%E5%A4%9A%E6%80%81%E8%B0%83%E7%94%A8%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%0A+++use+rand;%0A+++use+std::io::Read;%0A%0A+++trait+CheckSum%3CR:+Read%3E+%7B%0A+++++++fn+calc(%26mut+self,+r:+R)+-%3E+Vec%3Cu8%3E;%0A+++%7D%0A%0A+++struct+Xor;%0A%0A+++impl%3CR:+Read%3E+CheckSum%3CR%3E+for+Xor+%7B%0A+++++++fn+calc(%26mut+self,+mut+r:+R)+-%3E+Vec%3Cu8%3E+%7B%0A+++++++++++let+mut+res:+u8+=+0;%0A+++++++++++let+mut+buf+=+%5B0u8;+8%5D;%0A%0A+++++++++++loop+%7B%0A+++++++++++++++let+read+=+r.read(%26mut+buf).unwrap();%0A+++++++++++++++if+read+==+0+%7B%0A+++++++++++++++++++break;%0A+++++++++++++++%7D%0A%0A+++++++++++++++for+b+in+%26buf%5B..read%5D+%7B%0A+++++++++++++++++++res+%5E=+b;%0A+++++++++++++++%7D%0A+++++++++++%7D%0A+++++++++++vec!%5Bres%5D%0A+++++++%7D%0A+++%7D%0A%0A+++struct+Add;%0A%0A+++impl%3CR:+Read%3E+CheckSum%3CR%3E+for+Add+%7B%0A+++++++fn+calc(%26mut+self,+mut+r:+R)+-%3E+Vec%3Cu8%3E+%7B%0A+++++++++++let+mut+res:+u8+=+0;%0A+++++++++++let+mut+buf+=+%5B0u8;+8%5D;%0A%0A+++++++++++loop+%7B%0A+++++++++++++++let+read+=+r.read(%26mut+buf).unwrap();%0A+++++++++++++++if+read+==+0+%7B%0A+++++++++++++++++++break;%0A+++++++++++++++%7D%0A+++++++++++++++//+late+bound%0A+++++++++++++++for+b+in+%26buf%5B..read%5D+%7B%0A+++++++++++++++++++let+tmp+=+res+as+u16+%2B+*b+as+u16;%0A+++++++++++++++++++res+=+tmp+as+u8;%0A+++++++++++++++%7D%0A+++++++++++%7D%0A+++++++++++vec!%5Bres%5D%0A+++++++%7D%0A+++%7D%0A%0A+++let+mut+buf+=+%5B0u8;+128%5D;%0A%0A+++//+late+bound%0A+++let+mut+checker:+Box%3Cdyn+for%3C'f%3E+CheckSum%3C%26'f+%5Bu8%5D%3E%3E+=+if+rand::random()+%7B%0A+++++++println!(%22Initializing+Xor+Checksum%22);%0A+++++++Box::new(Xor)%0A+++%7D+else+%7B%0A+++++++println!(%22Initializing+Add+Checksum%22);%0A+++++++Box::new(Add)%0A+++%7D;%0A%0A+++let+mut+data+=+%22data.read(%26mut+buf).unwrap()%22.as_bytes();%0A+++let+mut+i+=+0;%0A%0A+++loop+%7B%0A+++++++let+chunk_size+=+data.read(%26mut+buf).unwrap();%0A+++++++if+chunk_size+==+0+%7B%0A+++++++++++break;%0A+++++++%7D%0A+++++++let+cs+=+checker.calc(%26buf%5B..chunk_size%5D);%0A+++++++println!(%22CheckSum+%7B%7D+is+%7B:?%7D%22,+i,+cs);%0A+++++++i+%2B=+1;%0A+++%7D%0A%7D&amp;edition=2021">Run</a></div>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="from_principle_to_practice" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0-nightly (e1eaa2d5d 2023-02-06)" data-search-js="search-28136cea55c34037.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>